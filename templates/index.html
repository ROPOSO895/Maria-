<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0d0015">
<meta name="apple-mobile-web-app-capable" content="yes">
<link rel="manifest" href="/static/manifest.json">
<title>MARIA</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400&family=Jost:wght@200;300;400;500&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0d0015;
  --bg2:#130020;
  --bg3:#1a0030;
  --rose:#ff6eb4;
  --violet:#b44fff;
  --soft:#e8c8ff;
  --dim:rgba(232,200,255,0.35);
  --dimmer:rgba(232,200,255,0.15);
  --card:rgba(30,0,55,0.7);
  --border:rgba(180,79,255,0.2);
  --border2:rgba(255,110,180,0.25);
  --glow:0 0 30px rgba(180,79,255,0.25);
}
*{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden}
body{min-height:0;}
body{
  background:var(--bg);
  color:var(--soft);
  font-family:'Jost',sans-serif;
  display:flex;flex-direction:column;
  position:relative;
  height:100%;max-height:100vh;
}

/* AMBIENT BG */
body::before{
  content:'';position:fixed;inset:0;
  background:
    radial-gradient(ellipse at 15% 20%,rgba(180,79,255,0.12) 0%,transparent 55%),
    radial-gradient(ellipse at 85% 80%,rgba(255,110,180,0.1) 0%,transparent 50%),
    radial-gradient(ellipse at 50% 50%,rgba(100,0,180,0.06) 0%,transparent 70%);
  pointer-events:none;z-index:0;
}

/* PARTICLE DOTS */
body::after{
  content:'';position:fixed;inset:0;
  background-image:radial-gradient(rgba(255,110,180,0.15) 1px,transparent 1px);
  background-size:32px 32px;
  pointer-events:none;z-index:0;
  animation:drift 20s linear infinite;
}
@keyframes drift{0%{background-position:0 0}100%{background-position:32px 32px}}

/* TOPBAR */
.top{
  flex-shrink:0;position:relative;z-index:10;
  display:flex;align-items:center;gap:12px;
  padding:12px 16px;
  background:rgba(13,0,21,0.92);
  border-bottom:1px solid var(--border);
  backdrop-filter:blur(20px);
}
.top::after{
  content:'';position:absolute;bottom:-1px;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--rose),var(--violet),transparent);
  opacity:0.5;
}
.mbtn{
  background:transparent;border:1px solid var(--border2);
  color:var(--rose);font-size:0.9rem;cursor:pointer;
  padding:6px 10px;border-radius:8px;
  transition:all 0.3s;
}
.mbtn:active{background:rgba(255,110,180,0.1);}
.logo-wrap{display:flex;align-items:center;gap:8px;}
.logo-gem{
  width:8px;height:8px;
  background:linear-gradient(135deg,var(--rose),var(--violet));
  border-radius:2px;
  transform:rotate(45deg);
  box-shadow:0 0 10px var(--rose);
  animation:gem 2s ease-in-out infinite;
}
@keyframes gem{0%,100%{opacity:1;box-shadow:0 0 10px var(--rose)}50%{opacity:0.5;box-shadow:0 0 20px var(--violet)}}
.logo{
  font-family:'Cormorant Garamond',serif;
  font-size:1.3rem;font-weight:600;
  background:linear-gradient(90deg,var(--rose),var(--violet));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  letter-spacing:0.25em;
}
.top-right{margin-left:auto;display:flex;align-items:center;gap:10px;}
.status{
  padding:3px 10px;
  border:1px solid rgba(255,110,180,0.3);
  border-radius:20px;
  font-family:'DM Mono',monospace;
  font-size:0.42rem;color:var(--rose);
  letter-spacing:0.1em;
}
.clk{font-family:'DM Mono',monospace;font-size:0.6rem;color:var(--dim);}

/* SIDEBAR */
.ovl{position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:99;display:none;backdrop-filter:blur(4px);}
.ovl.show{display:block;}
.sb{
  position:fixed;top:0;left:-300px;width:300px;height:100%;
  background:rgba(10,0,18,0.98);
  border-right:1px solid var(--border);
  z-index:100;transition:left 0.35s cubic-bezier(0.4,0,0.2,1);
  display:flex;flex-direction:column;
  backdrop-filter:blur(20px);
}
.sb.open{left:0;}
.sb-head{
  padding:16px;border-bottom:1px solid var(--border);
  display:flex;justify-content:space-between;align-items:center;
}
.sb-title{font-family:'Cormorant Garamond',serif;font-size:0.8rem;font-weight:600;color:var(--rose);letter-spacing:0.2em;}
.sb-x{background:transparent;border:1px solid var(--border2);color:var(--rose);font-size:0.8rem;cursor:pointer;padding:4px 9px;border-radius:6px;}
.nwb{
  margin:12px;padding:11px;
  background:linear-gradient(135deg,rgba(255,110,180,0.08),rgba(180,79,255,0.08));
  border:1px solid var(--border2);border-radius:12px;
  color:var(--rose);font-family:'Jost',sans-serif;font-size:0.7rem;
  font-weight:500;letter-spacing:0.1em;cursor:pointer;
  transition:all 0.3s;
}
.nwb:active{background:linear-gradient(135deg,rgba(255,110,180,0.18),rgba(180,79,255,0.18));}
.clist{flex:1;overflow-y:auto;padding:6px;}
.clist::-webkit-scrollbar{width:2px;}
.clist::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}
.citem{
  padding:10px 12px;border-radius:10px;margin-bottom:4px;
  cursor:pointer;border:1px solid transparent;
  display:flex;justify-content:space-between;align-items:center;
  transition:all 0.2s;
}
.citem:active,.citem.active{background:rgba(180,79,255,0.08);border-color:var(--border);}
.cit{font-size:0.78rem;color:var(--soft);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:400;}
.cid2{font-family:'DM Mono',monospace;font-size:0.38rem;color:var(--dimmer);margin-top:3px;}
.cdl{background:transparent;border:none;color:rgba(255,80,80,0.35);cursor:pointer;font-size:0.8rem;padding:2px 6px;}

/* TABS */
.tabs{
  flex-shrink:0;display:flex;
  background:rgba(13,0,21,0.95);
  border-bottom:1px solid var(--border);
  overflow-x:auto;z-index:5;
}
.tabs::-webkit-scrollbar{display:none;}
.tab{
  flex:1;min-width:55px;padding:9px 4px;
  background:transparent;border:none;
  color:var(--dimmer);
  font-family:'Jost',sans-serif;font-size:0.55rem;
  font-weight:400;letter-spacing:0.08em;
  cursor:pointer;border-bottom:2px solid transparent;
  white-space:nowrap;transition:all 0.3s;
}
.tab.on{color:var(--rose);border-bottom-color:var(--rose);}

/* PAGES */
.pg{display:none;flex:1;overflow-y:auto;flex-direction:column;min-height:0;}
.pg.on{display:flex;}
.pg::-webkit-scrollbar{width:2px;}
.pg::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}

/* ===== CHAT PAGE ===== */
#pg-chat{padding:0;min-height:0;}

/* MARIA AVATAR SECTION */
.maria-hero{
  flex-shrink:0;
  display:flex;flex-direction:column;align-items:center;
  padding:16px 20px 10px;
  position:relative;
}

/* 2D MARIA MODEL */
.maria-model{
  position:relative;width:130px;height:140px;margin:0 auto 8px;
}
.maria-aura{
  position:absolute;inset:-20px;border-radius:50%;
  background:radial-gradient(circle,rgba(255,110,180,0.15) 0%,rgba(180,79,255,0.08) 50%,transparent 70%);
  animation:aura 3s ease-in-out infinite;
}
@keyframes aura{0%,100%{transform:scale(1);opacity:0.7}50%{transform:scale(1.1);opacity:1}}
.maria-ring1{
  position:absolute;inset:-8px;border-radius:50%;
  border:1px solid rgba(255,110,180,0.2);
  animation:spin1 8s linear infinite;
}
.maria-ring2{
  position:absolute;inset:-14px;border-radius:50%;
  border:1px dashed rgba(180,79,255,0.15);
  animation:spin1 12s linear infinite reverse;
}
@keyframes spin1{to{transform:rotate(360deg)}}

/* SVG FACE */
.maria-face{
  position:relative;z-index:2;
  width:100px;height:100px;
}
.maria-face svg{width:100%;height:100%;}

/* TALKING ANIMATION */
.maria-face.talking .mouth-path{
  animation:mouthtalk 0.2s ease-in-out infinite alternate;
}
@keyframes mouthtalk{
  0%{d:path("M 45 72 Q 60 78 75 72");}
  100%{d:path("M 45 72 Q 60 85 75 72");}
}
.maria-face.idle .mouth-path{
  animation:mouthidle 3s ease-in-out infinite;
}
@keyframes mouthidle{
  0%,100%{d:path("M 45 72 Q 60 78 75 72");}
  50%{d:path("M 45 73 Q 60 76 75 73");}
}

/* EYE BLINK */
.eye-l,.eye-r{animation:blink 4s ease-in-out infinite;}
.eye-r{animation-delay:0.1s;}
@keyframes blink{0%,45%,55%,100%{transform:scaleY(1)}50%{transform:scaleY(0.1)}}

/* THINKING - eyes move */
.maria-face.thinking .eye-l{animation:eyethink 0.8s ease-in-out infinite alternate;}
.maria-face.thinking .eye-r{animation:eyethink 0.8s ease-in-out infinite alternate 0.2s;}
@keyframes eyethink{0%{transform:translateX(-2px)}100%{transform:translateX(2px)}}

.maria-name{
  font-family:'Cormorant Garamond',serif;
  font-size:1.4rem;font-weight:600;font-style:italic;
  background:linear-gradient(90deg,var(--rose),var(--violet));
  -webkit-background-clip:text;-webkit-text-fill-color:transparent;
  letter-spacing:0.1em;margin-bottom:3px;
}
.maria-sub{
  font-family:'DM Mono',monospace;font-size:0.38rem;
  color:var(--dimmer);letter-spacing:0.25em;margin-bottom:10px;
}
.maria-status{
  font-family:'DM Mono',monospace;font-size:0.5rem;
  color:var(--rose);letter-spacing:0.15em;min-height:14px;
  animation:statusglow 2s ease-in-out infinite;
}
@keyframes statusglow{0%,100%{opacity:0.7}50%{opacity:1;text-shadow:0 0 10px var(--rose)}}

/* MOOD DISPLAY */
.mood-bar{
  display:flex;gap:8px;margin-top:12px;flex-wrap:wrap;justify-content:center;
}
.mood-chip{
  padding:4px 12px;border-radius:20px;
  font-size:0.6rem;font-weight:500;
  border:1px solid var(--border2);
  color:var(--dim);cursor:pointer;
  transition:all 0.3s;
}
.mood-chip.on,.mood-chip:active{
  background:linear-gradient(135deg,rgba(255,110,180,0.2),rgba(180,79,255,0.2));
  color:var(--rose);border-color:var(--rose);
}

/* MESSAGES */
.msgs{padding:12px 14px;flex:1;}
.msg{margin-bottom:16px;animation:msgin 0.35s ease-out;}
@keyframes msgin{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.mlbl{
  font-family:'DM Mono',monospace;font-size:0.4rem;
  letter-spacing:0.15em;color:var(--dim);opacity:0.6;
  margin-bottom:5px;
}
.msg.u .mlbl{text-align:right;}
.bub{
  padding:11px 15px;border-radius:16px;
  line-height:1.7;font-size:0.88rem;
  max-width:85%;font-weight:300;
}
.msg.u .bub{
  background:linear-gradient(135deg,rgba(255,110,180,0.1),rgba(180,79,255,0.08));
  border:1px solid rgba(255,110,180,0.2);
  margin-left:auto;border-bottom-right-radius:4px;
}
.msg.b .bub{
  background:rgba(25,0,45,0.8);
  border:1px solid var(--border);
  border-bottom-left-radius:4px;color:rgba(232,200,255,0.85);
}
.typi{
  display:none;gap:5px;padding:11px 15px;
  width:fit-content;
  background:rgba(25,0,45,0.8);border:1px solid var(--border);
  border-radius:16px;border-bottom-left-radius:4px;
  margin:0 14px 8px;
}
.td{width:6px;height:6px;border-radius:50%;background:var(--violet);animation:tda 1.2s infinite;}
.td:nth-child(2){animation-delay:.18s}.td:nth-child(3){animation-delay:.36s}
@keyframes tda{0%,100%{opacity:.2;transform:translateY(0)}50%{opacity:1;transform:translateY(-4px)}}

/* MEMORY CARD */
.mem-card{
  margin:8px 14px;padding:10px 14px;
  background:linear-gradient(135deg,rgba(255,110,180,0.05),rgba(180,79,255,0.05));
  border:1px solid var(--border);border-radius:12px;
  font-size:0.72rem;color:var(--dim);line-height:1.6;
  display:none;
}
.mem-card.show{display:block;}
.mem-title{font-family:'DM Mono',monospace;font-size:0.42rem;color:var(--rose);letter-spacing:0.15em;margin-bottom:6px;}

/* FEATURE PAGES */
#pg-memory,#pg-journal,#pg-mood{padding:14px;}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;padding:16px;margin-bottom:12px;
  position:relative;overflow:hidden;
  backdrop-filter:blur(10px);
}
.card::before{
  content:'';position:absolute;top:0;left:0;right:0;height:1px;
  background:linear-gradient(90deg,transparent,var(--rose),var(--violet),transparent);
  opacity:0.4;
}
.ctit{
  font-family:'Cormorant Garamond',serif;
  font-size:0.9rem;font-weight:600;font-style:italic;
  color:var(--rose);margin-bottom:12px;letter-spacing:0.05em;
}
.ldt{font-size:0.55rem;color:var(--dimmer);text-align:center;padding:20px;}

/* MEMORY LIST */
.mem-item{
  padding:10px 0;border-bottom:1px solid rgba(180,79,255,0.1);
  display:flex;justify-content:space-between;align-items:flex-start;
}
.mem-item:last-child{border-bottom:none;}
.mem-key{font-family:'DM Mono',monospace;font-size:0.52rem;color:var(--violet);margin-right:10px;flex-shrink:0;}
.mem-val{font-size:0.78rem;color:var(--soft);line-height:1.5;flex:1;}
.mem-del{background:transparent;border:none;color:rgba(255,80,80,0.4);cursor:pointer;font-size:0.8rem;padding:0 4px;}

/* ADD MEMORY */
.add-row{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap;}
.inp{
  flex:1;min-width:80px;padding:9px 13px;
  background:rgba(180,79,255,0.04);
  border:1px solid var(--border);border-radius:20px;
  color:var(--soft);font-family:'Jost',sans-serif;font-size:0.82rem;
  outline:none;
}
.inp:focus{border-color:var(--rose);}
.inp::placeholder{color:var(--dimmer);}
.pbtn{
  padding:9px 16px;
  background:linear-gradient(135deg,rgba(255,110,180,0.15),rgba(180,79,255,0.15));
  border:1px solid var(--border2);border-radius:20px;
  color:var(--rose);font-family:'Jost',sans-serif;font-size:0.65rem;
  font-weight:500;cursor:pointer;white-space:nowrap;
  transition:all 0.3s;
}
.pbtn:active{background:linear-gradient(135deg,rgba(255,110,180,0.25),rgba(180,79,255,0.25));}

/* JOURNAL */
.journal-item{
  padding:12px;margin-bottom:8px;
  background:rgba(180,79,255,0.04);
  border:1px solid rgba(180,79,255,0.1);
  border-radius:12px;
}
.j-date{font-family:'DM Mono',monospace;font-size:0.4rem;color:var(--dimmer);margin-bottom:5px;}
.j-mood{font-size:0.7rem;margin-bottom:4px;}
.j-text{font-size:0.8rem;color:var(--soft);line-height:1.6;font-weight:300;}
textarea.inp{border-radius:12px;resize:none;min-height:80px;width:100%;margin-bottom:8px;}

/* MOOD PAGE */
.mood-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:16px;}
.mood-opt{
  padding:14px 8px;text-align:center;
  background:rgba(180,79,255,0.04);
  border:1px solid var(--border);border-radius:14px;
  cursor:pointer;transition:all 0.3s;
}
.mood-opt:active,.mood-opt.sel{
  background:linear-gradient(135deg,rgba(255,110,180,0.15),rgba(180,79,255,0.15));
  border-color:var(--rose);
}
.mood-emoji{font-size:1.6rem;display:block;margin-bottom:4px;}
.mood-lbl{font-size:0.55rem;color:var(--dim);}
.mood-history{margin-top:4px;}
.mh-item{
  display:flex;align-items:center;gap:10px;
  padding:8px 0;border-bottom:1px solid rgba(180,79,255,0.08);
  font-size:0.72rem;color:var(--soft);
}
.mh-item:last-child{border-bottom:none;}
.mh-date{font-family:'DM Mono',monospace;font-size:0.4rem;color:var(--dimmer);flex-shrink:0;}

/* BOTTOM */

.bot::before{
  content:'';display:block;height:1px;margin-bottom:10px;
  background:linear-gradient(90deg,transparent,var(--violet),var(--rose),transparent);
  opacity:0.2;
}


#msg:focus{border-color:var(--rose);}
#msg::placeholder{color:var(--dimmer);}

#sbtn:active{transform:scale(0.95);}
#sbtn:disabled{opacity:0.35;cursor:not-allowed;transform:none;box-shadow:none;}

/* TOAST */
.toast{
  position:fixed;bottom:80px;left:50%;
  transform:translateX(-50%) translateY(8px);
  background:rgba(20,0,35,0.97);
  border:1px solid var(--border2);border-radius:12px;
  padding:8px 18px;font-size:0.52rem;color:var(--rose);
  font-family:'DM Mono',monospace;letter-spacing:0.1em;
  opacity:0;transition:all 0.3s;z-index:9999;
  pointer-events:none;white-space:nowrap;
}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
body{padding-bottom:70px}
</style>
</head>
<body>

<div class="toast" id="toast"></div>
<div class="ovl" id="ovl"></div>

<!-- SIDEBAR -->
<div class="sb" id="sb">
  <div class="sb-head">
    <div class="sb-title">‚ú¶ CONVERSATIONS</div>
    <button class="sb-x" onclick="closeSB()">‚úï</button>
  </div>
  <button class="nwb" onclick="newChat()">+ New Conversation</button>
  <div class="clist" id="clist"></div>
</div>

<!-- TOPBAR -->
<div class="top">
  <button class="mbtn" onclick="openSB()">‚ò∞</button>
  <div class="logo-wrap">
    <div class="logo-gem"></div>
    <div class="logo">MARIA</div>
  </div>
  <div class="top-right">
    <div class="status" id="status-pill">‚óè ONLINE</div>
    <div class="clk" id="clk">--:--</div>
  </div>
</div>

<!-- TABS -->
<div class="tabs">
  <button class="tab on" onclick="showPg('chat',this)">‚ú¶ Chat</button>
  <button class="tab" onclick="showPg('memory',this)">‚óà Memory</button>
  <button class="tab" onclick="showPg('mood',this)">‚óâ Mood</button>
  <button class="tab" onclick="showPg('journal',this)">‚úé Journal</button>
</div>

<!-- CHAT PAGE -->
<div class="pg on" id="pg-chat">
  <div class="maria-hero">
    <!-- 2D MARIA MODEL -->
    <div class="maria-model">
      <div class="maria-aura"></div>
      <div class="maria-ring1"></div>
      <div class="maria-ring2"></div>
      <div class="maria-face idle" id="mariaFace">
        <svg viewBox="0 0 100 110" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <radialGradient id="sg" cx="50%" cy="35%" r="65%">
      <stop offset="0%" stop-color="#ffe8f0"/><stop offset="100%" stop-color="#ffb0cc"/>
    </radialGradient>
    <radialGradient id="hg" cx="50%" cy="25%" r="70%">
      <stop offset="0%" stop-color="#5500aa"/><stop offset="100%" stop-color="#1a0035"/>
    </radialGradient>
    <radialGradient id="eg" cx="35%" cy="30%" r="65%">
      <stop offset="0%" stop-color="#ee77ff"/><stop offset="100%" stop-color="#6600cc"/>
    </radialGradient>
    <filter id="gl"><feGaussianBlur stdDeviation="1.5" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
  </defs>
  <!-- hair back -->
  <ellipse cx="50" cy="45" rx="32" ry="38" fill="url(#hg)"/>
  <!-- long hair sides -->
  <path d="M 18 50 Q 12 75 16 100 Q 22 95 24 72 Q 26 58 28 50Z" fill="url(#hg)"/>
  <path d="M 82 50 Q 88 75 84 100 Q 78 95 76 72 Q 74 58 72 50Z" fill="url(#hg)"/>
  <!-- neck -->
  <rect x="44" y="78" width="12" height="14" rx="4" fill="url(#sg)"/>
  <!-- face -->
  <ellipse cx="50" cy="50" rx="26" ry="30" fill="url(#sg)"/>
  <!-- hair top -->
  <ellipse cx="50" cy="24" rx="28" ry="13" fill="url(#hg)"/>
  <path d="M 24 36 Q 35 18 50 22 Q 65 18 76 36 Q 66 28 57 30 Q 50 28 43 30 Q 34 28 24 36Z" fill="url(#hg)"/>
  <!-- LEFT EYE -->
  <g class="eye-l" style="transform-origin:36px 48px">
    <ellipse cx="36" cy="48" rx="9" ry="10" fill="white"/>
    <ellipse cx="36" cy="49" rx="6.5" ry="7.5" fill="url(#eg)" filter="url(#gl)"/>
    <ellipse cx="36" cy="50" rx="3.5" ry="4" fill="#220044"/>
    <circle cx="39" cy="46" r="2" fill="white"/>
    <path d="M 27 41 Q 36 37 45 41" stroke="#330055" stroke-width="2.5" fill="none" stroke-linecap="round"/>
  </g>
  <!-- RIGHT EYE -->
  <g class="eye-r" style="transform-origin:64px 48px">
    <ellipse cx="64" cy="48" rx="9" ry="10" fill="white"/>
    <ellipse cx="64" cy="49" rx="6.5" ry="7.5" fill="url(#eg)" filter="url(#gl)"/>
    <ellipse cx="64" cy="50" rx="3.5" ry="4" fill="#220044"/>
    <circle cx="67" cy="46" r="2" fill="white"/>
    <path d="M 55 41 Q 64 37 73 41" stroke="#330055" stroke-width="2.5" fill="none" stroke-linecap="round"/>
  </g>
  <!-- blush -->
  <ellipse cx="24" cy="57" rx="8" ry="5" fill="rgba(255,130,170,0.3)"/>
  <ellipse cx="76" cy="57" rx="8" ry="5" fill="rgba(255,130,170,0.3)"/>
  <!-- nose dot -->
  <circle cx="50" cy="60" r="1.2" fill="rgba(210,120,150,0.3)"/>
  <!-- mouth -->
  <path class="mouth-path" d="M 40 67 Q 50 73 60 67" stroke="#e06090" stroke-width="2" fill="none" stroke-linecap="round"/>
  <!-- earrings -->
  <circle cx="24" cy="60" r="3" fill="url(#eg)" filter="url(#gl)"/>
  <circle cx="76" cy="60" r="3" fill="url(#eg)" filter="url(#gl)"/>
  <!-- shoulders -->
  <path d="M 5 105 Q 22 88 42 82 L 58 82 Q 78 88 95 105Z" fill="url(#hg)"/>
  <!-- collar sparkle -->
  <circle cx="50" cy="84" r="2" fill="rgba(255,180,255,0.8)" filter="url(#gl)"/>
</svg>
      </div>
    </div>
    <div class="maria-name">Maria</div>
    <div class="maria-sub">YOUR PERSONAL AI COMPANION</div>
    <div class="maria-status" id="mariaStatus">How can I help you today?</div>
    <div class="mood-bar" id="quickMood">
      <div class="mood-chip" onclick="quickMoodSet('üòä Happy')">üòä Happy</div>
      <div class="mood-chip" onclick="quickMoodSet('üòî Sad')">üòî Sad</div>
      <div class="mood-chip" onclick="quickMoodSet('üò§ Stressed')">üò§ Stressed</div>
      <div class="mood-chip" onclick="quickMoodSet('üò¥ Tired')">üò¥ Tired</div>
      <div class="mood-chip" onclick="quickMoodSet('üî• Motivated')">üî• Motivated</div>
    </div>
  </div>

  <!-- MEMORY PREVIEW -->
  <div class="mem-card" id="memCard">
    <div class="mem-title">‚óà WHAT I REMEMBER ABOUT YOU</div>
    <div id="memPreview"></div>
  </div>

  <div class="msgs" id="msgs"></div>
  <div class="typi" id="typi"><div class="td"></div><div class="td"></div><div class="td"></div></div>
</div>

<!-- MEMORY PAGE -->
<div class="pg" id="pg-memory">
  <div class="card">
    <div class="ctit">‚óà What Maria Remembers</div>
    <div id="memList"><div class="ldt">Nothing saved yet. Tell Maria about yourself!</div></div>
    <div class="add-row">
      <input type="text" class="inp" id="memKey" placeholder="Topic (e.g. My name)">
      <input type="text" class="inp" id="memVal" placeholder="Value (e.g. Rohan)">
      <button class="pbtn" onclick="addMem()">Save</button>
    </div>
  </div>
  <div class="card">
    <div class="ctit">‚ú¶ Suggestions</div>
    <div style="display:flex;gap:6px;flex-wrap:wrap;">
      <button class="mood-chip" onclick="fillMem('My name','')">My name</button>
      <button class="mood-chip" onclick="fillMem('My age','')">My age</button>
      <button class="mood-chip" onclick="fillMem('My city','')">My city</button>
      <button class="mood-chip" onclick="fillMem('My hobby','')">My hobby</button>
      <button class="mood-chip" onclick="fillMem('My favourite food','')">Fav food</button>
      <button class="mood-chip" onclick="fillMem('My best friend','')">Best friend</button>
    </div>
  </div>
</div>

<!-- MOOD PAGE -->
<div class="pg" id="pg-mood">
  <div class="card">
    <div class="ctit">‚óâ How are you feeling?</div>
    <div class="mood-grid">
      <div class="mood-opt" onclick="logMood('üòä Happy',this)"><span class="mood-emoji">üòä</span><span class="mood-lbl">Happy</span></div>
      <div class="mood-opt" onclick="logMood('üòî Sad',this)"><span class="mood-emoji">üòî</span><span class="mood-lbl">Sad</span></div>
      <div class="mood-opt" onclick="logMood('üò§ Stressed',this)"><span class="mood-emoji">üò§</span><span class="mood-lbl">Stressed</span></div>
      <div class="mood-opt" onclick="logMood('üò¥ Tired',this)"><span class="mood-emoji">üò¥</span><span class="mood-lbl">Tired</span></div>
      <div class="mood-opt" onclick="logMood('üî• Motivated',this)"><span class="mood-emoji">üî•</span><span class="mood-lbl">Motivated</span></div>
      <div class="mood-opt" onclick="logMood('üò∞ Anxious',this)"><span class="mood-emoji">üò∞</span><span class="mood-lbl">Anxious</span></div>
      <div class="mood-opt" onclick="logMood('ü•∞ Loved',this)"><span class="mood-emoji">ü•∞</span><span class="mood-lbl">Loved</span></div>
      <div class="mood-opt" onclick="logMood('üòê Meh',this)"><span class="mood-emoji">üòê</span><span class="mood-lbl">Meh</span></div>
      <div class="mood-opt" onclick="logMood('üòÅ Excited',this)"><span class="mood-emoji">üòÅ</span><span class="mood-lbl">Excited</span></div>
    </div>
  </div>
  <div class="card">
    <div class="ctit">‚ú¶ Mood History</div>
    <div class="mood-history" id="moodHistory"><div class="ldt">No mood logged yet.</div></div>
  </div>
</div>

<!-- JOURNAL PAGE -->
<div class="pg" id="pg-journal">
  <div class="card">
    <div class="ctit">‚úé Today's Entry</div>
    <select class="inp" id="journalMood" style="margin-bottom:8px">
      <option value="">How are you feeling?</option>
      <option>üòä Happy</option><option>üòî Sad</option><option>üò§ Stressed</option>
      <option>üò¥ Tired</option><option>üî• Motivated</option><option>ü•∞ Loved</option>
    </select>
    <textarea class="inp" id="journalText" placeholder="Write your thoughts... Maria is listening." rows="4"></textarea>
    <button class="pbtn" style="width:100%;margin-top:4px" onclick="saveJournal()">Save Entry ‚ú¶</button>
  </div>
  <div class="card">
    <div class="ctit">‚óà Past Entries</div>
    <div id="journalList"><div class="ldt">No entries yet. Start writing!</div></div>
  </div>
</div>

<script>
try{if('serviceWorker'in navigator)navigator.serviceWorker.register('/static/sw.js');}catch(e){}

// CLOCK
setInterval(function(){
  var n=new Date(),h=n.getHours(),m=n.getMinutes();
  document.getElementById('clk').textContent=(h<10?'0'+h:h)+':'+(m<10?'0'+m:m);
},1000);

// TOAST
function toast(m){var t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(function(){t.classList.remove('show');},2200);}

// SIDEBAR
function openSB(){document.getElementById('sb').classList.add('open');document.getElementById('ovl').classList.add('show');}
function closeSB(){document.getElementById('sb').classList.remove('open');document.getElementById('ovl').classList.remove('show');}
document.getElementById('ovl').onclick=closeSB;

// TABS
function showPg(id,btn){
  document.querySelectorAll('.pg').forEach(function(p){p.classList.remove('on');});
  document.querySelectorAll('.tab').forEach(function(t){t.classList.remove('on');});
  document.getElementById('pg-'+id).classList.add('on');
  btn.classList.add('on');
}

// === STORAGE ===
var DB={
  chats:{},memory:{},moods:[],journal:[],currentChat:null
};
function loadDB(){try{var s=localStorage.getItem('maria_v1');if(s)DB=JSON.parse(s);}catch(e){}}
function saveDB(){try{localStorage.setItem('maria_v1',JSON.stringify(DB));}catch(e){}}
function gdate(){var n=new Date();return ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][n.getDay()]+' '+n.getDate()+' '+['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][n.getMonth()];}
function gdatetime(){var n=new Date();return gdate()+' '+('0'+n.getHours()).slice(-2)+':'+('0'+n.getMinutes()).slice(-2);}

// === MEMORY ===
function renderMemList(){
  var el=document.getElementById('memList');
  var keys=Object.keys(DB.memory);
  if(!keys.length){el.innerHTML='<div class="ldt">Nothing saved yet.</div>';return;}
  var h='';
  keys.forEach(function(k){
    h+='<div class="mem-item"><span class="mem-key">'+k+'</span><span class="mem-val">'+DB.memory[k]+'</span><button class="mem-del" onclick="delMem(\''+k+'\')">‚úï</button></div>';
  });
  el.innerHTML=h;
  // Update preview
  renderMemPreview();
}
function renderMemPreview(){
  var keys=Object.keys(DB.memory);
  if(!keys.length){document.getElementById('memCard').classList.remove('show');return;}
  var h='';
  keys.slice(0,4).forEach(function(k){h+='<span style="color:var(--violet);font-size:0.52rem">'+k+':</span> <span style="font-size:0.72rem;margin-right:10px">'+DB.memory[k]+'</span>';});
  document.getElementById('memPreview').innerHTML=h;
  document.getElementById('memCard').classList.add('show');
}
function addMem(){
  var k=document.getElementById('memKey').value.trim();
  var v=document.getElementById('memVal').value.trim();
  if(!k||!v){toast('Fill both fields');return;}
  DB.memory[k]=v;saveDB();renderMemList();
  document.getElementById('memKey').value='';document.getElementById('memVal').value='';
  toast('Saved ‚ú¶');
}
function delMem(k){delete DB.memory[k];saveDB();renderMemList();}
function fillMem(k,v){
  document.getElementById('memKey').value=k;
  document.getElementById('memVal').value=v;
  document.getElementById('memVal').focus();
  showPg('memory',document.querySelectorAll('.tab')[1]);
}

// === MOOD ===
function logMood(mood,btn){
  document.querySelectorAll('.mood-opt').forEach(function(b){b.classList.remove('sel');});
  btn.classList.add('sel');
  DB.moods.unshift({mood:mood,date:gdatetime()});
  if(DB.moods.length>30)DB.moods=DB.moods.slice(0,30);
  saveDB();renderMoodHistory();
  toast('Mood logged ‚ú¶');
  // Tell Maria
  if(DB.currentChat){
    addMsg('u','My mood right now: '+mood,true);
    askMaria('My mood right now: '+mood);
  }
}
function quickMoodSet(mood){
  document.querySelectorAll('.mood-chip').forEach(function(c){c.classList.remove('on');});
  event.target.classList.add('on');
  DB.moods.unshift({mood:mood,date:gdatetime()});
  if(DB.moods.length>30)DB.moods=DB.moods.slice(0,30);
  saveDB();
}
function renderMoodHistory(){
  var el=document.getElementById('moodHistory');
  if(!DB.moods.length){el.innerHTML='<div class="ldt">No mood logged yet.</div>';return;}
  var h='';
  DB.moods.slice(0,10).forEach(function(m){
    h+='<div class="mh-item"><span style="font-size:1.1rem">'+m.mood.split(' ')[0]+'</span><span>'+m.mood.split(' ').slice(1).join(' ')+'</span><span class="mh-date" style="margin-left:auto">'+m.date+'</span></div>';
  });
  el.innerHTML=h;
}

// === JOURNAL ===
function saveJournal(){
  var mood=document.getElementById('journalMood').value;
  var text=document.getElementById('journalText').value.trim();
  if(!text){toast('Write something first');return;}
  DB.journal.unshift({mood:mood,text:text,date:gdatetime()});
  if(DB.journal.length>50)DB.journal=DB.journal.slice(0,50);
  saveDB();renderJournal();
  document.getElementById('journalText').value='';document.getElementById('journalMood').value='';
  toast('Entry saved ‚ú¶');
}
function renderJournal(){
  var el=document.getElementById('journalList');
  if(!DB.journal.length){el.innerHTML='<div class="ldt">No entries yet.</div>';return;}
  var h='';
  DB.journal.forEach(function(j){
    h+='<div class="journal-item"><div class="j-date">'+j.date+'</div><div class="j-mood">'+j.mood+'</div><div class="j-text">'+j.text+'</div></div>';
  });
  el.innerHTML=h;
}

// === CHAT ===
function renderSB(){
  var el=document.getElementById('clist');
  var keys=Object.keys(DB.chats).reverse();
  if(!keys.length){el.innerHTML='<div style="font-size:0.5rem;color:var(--dimmer);text-align:center;padding:30px">No conversations yet</div>';return;}
  var h='';
  keys.forEach(function(id){
    var c=DB.chats[id],a=id===DB.currentChat?' active':'';
    h+='<div class="citem'+a+'" onclick="loadChat(\''+id+'\')">'
      +'<div style="flex:1;min-width:0"><div class="cit">'+(c.title||'Conversation')+'</div><div class="cid2">'+(c.date||'')+'</div></div>'
      +'<button class="cdl" onclick="event.stopPropagation();delChat(\''+id+'\')">‚úï</button></div>';
  });
  el.innerHTML=h;
}
function delChat(id){delete DB.chats[id];if(DB.currentChat===id){DB.currentChat=null;document.getElementById('msgs').innerHTML='';}saveDB();renderSB();}
function newChat(){
  DB.currentChat='c'+Date.now();
  DB.chats[DB.currentChat]={title:'New Conversation',date:gdate(),msgs:[]};
  saveDB();document.getElementById('msgs').innerHTML='';renderSB();closeSB();toast('New conversation ‚ú¶');
}
function loadChat(id){
  DB.currentChat=id;document.getElementById('msgs').innerHTML='';
  var c=DB.chats[id];
  if(c&&c.msgs)c.msgs.forEach(function(m){addMsg(m.r,m.t,false);});
  renderSB();closeSB();
  showPg('chat',document.querySelectorAll('.tab')[0]);
}

function addMsg(role,text,sv){
  var msgs=document.getElementById('msgs');
  var d=document.createElement('div');d.className='msg '+role;
  var safe=text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>');
  d.innerHTML='<div class="mlbl">'+(role==='u'?'You':'Maria')+'</div><div class="bub">'+safe+'</div>';
  msgs.appendChild(d);
  document.getElementById('pg-chat').scrollTop=99999;
  if(sv&&DB.currentChat){
    var c=DB.chats[DB.currentChat];
    if(!c)return;
    c.msgs.push({r:role,t:text});
    if(c.msgs.length===1&&role==='u')c.title=text.length>30?text.substring(0,30)+'...':text;
    saveDB();renderSB();
  }
}

// MARIA FACE STATES
function setFace(state){
  var face=document.getElementById('mariaFace');
  var st=document.getElementById('mariaStatus');
  var pill=document.getElementById('status-pill');
  if(!face)return;
  face.className='maria-face '+state;
  if(state==='thinking'){
    if(st)st.textContent='Thinking...';
    if(pill){pill.textContent='‚óè THINKING';pill.style.color='var(--violet)';}
  }else if(state==='talking'){
    if(st)st.textContent='Responding...';
    if(pill){pill.textContent='‚óè RESPONDING';pill.style.color='var(--rose)';}
  }else{
    if(st)st.textContent='How can I help you today?';
    if(pill){pill.textContent='‚óè ONLINE';pill.style.color='var(--rose)';}
  }
}

// BUILD MEMORY CONTEXT
function buildMemCtx(){
  var keys=Object.keys(DB.memory);
  if(!keys.length)return '';
  var ctx='[Things I know about you: ';
  keys.forEach(function(k){ctx+=k+' is '+DB.memory[k]+', ';});
  if(DB.moods.length)ctx+='Current mood: '+DB.moods[0].mood+'. ';
  ctx+='] Use this to personalize your response naturally.';
  return ctx;
}

// SEND MESSAGE
function sendMsg(){
  var txt=document.getElementById('msg').value.trim();
  if(!txt)return;
  document.getElementById('msg').value='';
  document.getElementById('msg').style.height='auto';
  if(!DB.currentChat){newChat();}
  addMsg('u',txt,true);
  askMaria(txt);
}

// msg listeners
var msgEl = document.getElementById('msg');
if(msgEl){
  msgEl.addEventListener('keydown',function(e){
    if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMsg();}
  });
  msgEl.addEventListener('input',function(){
    this.style.height='auto';this.style.height=Math.min(this.scrollHeight,110)+'px';
  });
}

function askMaria(txt){
  setFace('thinking');
  document.getElementById('typi').style.display='flex';
  document.getElementById('sbtn').disabled=true;

  var memCtx=buildMemCtx();
  var sysMsg='You are Maria, a warm, empathetic and intelligent personal AI companion. You are feminine, caring, and remember everything about the user. '+memCtx+' Keep responses conversational and personal. Use their name if you know it.';

  fetch('https://maria-assistant-fthu.onrender.com/chat',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({message:txt,system:sysMsg})
  })
  .then(function(r){return r.json();})
  .then(function(d){
    document.getElementById('typi').style.display='none';
    document.getElementById('sbtn').disabled=false;
    var rep=d.reply||('Sorry, something went wrong.');
    addMsg('b',rep,true);
    setFace('talking');
    // Check if Maria detected something to remember
    autoMemory(txt,rep);
    setTimeout(function(){setFace('idle');},2000);
  })
  .catch(function(){
    document.getElementById('typi').style.display='none';
    document.getElementById('sbtn').disabled=false;
    addMsg('b','Sorry, I had trouble connecting. Please try again.',false);
    setFace('idle');
  });
}

// AUTO MEMORY - detect key info from conversation
function autoMemory(userMsg,reply){
  var lower=userMsg.toLowerCase();
  var nameMatch=lower.match(/my name is ([a-z]+)/i)||lower.match(/i am ([a-z]+)/i)||lower.match(/call me ([a-z]+)/i);
  if(nameMatch&&nameMatch[1]&&nameMatch[1].length>2){
    var name=nameMatch[1].charAt(0).toUpperCase()+nameMatch[1].slice(1);
    if(!DB.memory['My name']){DB.memory['My name']=name;saveDB();renderMemList();toast('Memory saved: Your name ‚ú¶');}
  }
  var cityMatch=lower.match(/i (?:live|am) (?:in|from) ([a-z ]+)/i);
  if(cityMatch&&cityMatch[1]){
    if(!DB.memory['My city']){DB.memory['My city']=cityMatch[1].trim();saveDB();renderMemList();toast('Memory saved: Your city ‚ú¶');}
  }
}

// INIT
loadDB();
renderMemList();
renderMoodHistory();
renderJournal();
renderSB();
if(!DB.currentChat){newChat();}
</script>
<div style="position:fixed;bottom:0;left:0;right:0;background:#06101e;padding:10px;z-index:999;display:flex;gap:8px;border-top:1px solid rgba(255,110,180,0.2)">
<textarea id="msg" style="flex:1;padding:10px;background:rgba(180,79,255,0.1);border:1px solid rgba(255,110,180,0.3);border-radius:20px;color:white;font-size:16px;outline:none;resize:none" rows="1" placeholder="Talk to Maria..."></textarea>
<button onclick="sendMsg()" style="width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,#ff6eb4,#b44fff);border:none;color:white;font-size:1.2rem;cursor:pointer;flex-shrink:0">&#10148;</button>
</div>
</body>
</html>
