<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>J.A.R.V.I.S</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: #050300;
    color: #f0d9a0;
    font-family: 'Exo 2', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }
  body::before {
    content: '';
    position: fixed; inset: 0;
    background-image: linear-gradient(rgba(200,150,50,0.03) 1px,transparent 1px), linear-gradient(90deg,rgba(200,150,50,0.03) 1px,transparent 1px);
    background-size: 40px 40px;
    pointer-events: none; z-index: 0;
  }
  .app { position:relative; z-index:1; max-width:700px; margin:0 auto; padding:20px; display:flex; flex-direction:column; min-height:100vh; }

  /* GLOBE */
  .header { text-align:center; padding:20px 0 16px; }
  .jarvis-globe { position:relative; width:200px; height:200px; margin:0 auto 16px; }
  .globe-glow { position:absolute; inset:-20px; border-radius:50%; background:radial-gradient(circle,rgba(255,120,0,0.15) 0%,transparent 70%); animation:glow-pulse 2.5s ease-in-out infinite; }
  @keyframes glow-pulse { 0%,100%{transform:scale(1);opacity:0.6} 50%{transform:scale(1.15);opacity:1} }
  .sphere { position:absolute; inset:0; border-radius:50%; background:radial-gradient(circle at 40% 35%, rgba(255,200,50,0.9) 0%, rgba(255,120,0,0.7) 25%, rgba(180,60,0,0.5) 50%, rgba(80,20,0,0.3) 70%, transparent 90%); box-shadow:0 0 40px rgba(255,120,0,0.6),0 0 80px rgba(255,80,0,0.3),inset 0 0 30px rgba(255,150,0,0.2); animation:sphere-pulse 3s ease-in-out infinite; }
  @keyframes sphere-pulse { 0%,100%{box-shadow:0 0 40px rgba(255,120,0,0.6),0 0 80px rgba(255,80,0,0.3)} 50%{box-shadow:0 0 60px rgba(255,150,0,0.9),0 0 120px rgba(255,80,0,0.5)} }
  .orbit { position:absolute; border-radius:50%; border:1px solid transparent; animation:spin linear infinite; }
  .o1{inset:10px;border-top-color:rgba(255,200,50,0.9);border-right-color:rgba(255,160,30,0.5);animation-duration:4s;}
  .o2{inset:25px;border-right-color:rgba(255,180,0,0.8);animation-duration:3s;animation-direction:reverse;}
  .o3{inset:40px;border-bottom-color:rgba(255,140,0,0.7);animation-duration:5s;}
  .o4{inset:55px;border-left-color:rgba(255,120,0,0.6);animation-duration:2.5s;animation-direction:reverse;}
  @keyframes spin { to{transform:rotate(360deg)} }
  .sparks { position:absolute; inset:0; border-radius:50%; overflow:hidden; }
  .spark { position:absolute; width:2px; height:2px; border-radius:50%; background:#ffdd00; box-shadow:0 0 4px #ff8800; animation:float-spark linear infinite; }
  .spark:nth-child(1){top:20%;left:60%;animation-duration:3s;}
  .spark:nth-child(2){top:70%;left:30%;animation-duration:4s;animation-delay:.5s;}
  .spark:nth-child(3){top:40%;left:80%;animation-duration:2.5s;animation-delay:1s;}
  .spark:nth-child(4){top:80%;left:60%;animation-duration:3.5s;animation-delay:.3s;}
  .spark:nth-child(5){top:30%;left:20%;animation-duration:4.5s;animation-delay:.8s;}
  .spark:nth-child(6){top:60%;left:75%;animation-duration:2s;animation-delay:1.5s;}
  @keyframes float-spark { 0%{transform:translateY(0) scale(1);opacity:1} 100%{transform:translateY(-30px) scale(0);opacity:0} }
  .core-bright { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); width:30px; height:30px; border-radius:50%; background:radial-gradient(circle,#fff 0%,#ffee00 30%,#ff8800 60%,transparent 80%); box-shadow:0 0 20px #ffcc00,0 0 40px #ff8800; animation:core-flicker 1.5s ease-in-out infinite; }
  @keyframes core-flicker { 0%,100%{transform:translate(-50%,-50%) scale(1)} 50%{transform:translate(-50%,-50%) scale(1.2)} }

  .title { font-family:'Orbitron',monospace; font-size:clamp(1.8rem,6vw,3rem); font-weight:900; color:#c8820a; letter-spacing:0.3em; text-shadow:0 0 30px rgba(200,130,10,0.7); animation:title-glow 3s ease-in-out infinite; }
  @keyframes title-glow { 0%,100%{text-shadow:0 0 20px rgba(200,120,10,0.6)} 50%{text-shadow:0 0 40px rgba(255,180,0,1),0 0 70px rgba(200,100,0,0.5)} }
  .subtitle { font-family:'Orbitron',monospace; font-size:0.52rem; letter-spacing:0.35em; color:rgba(200,120,20,0.4); margin:4px 0 8px; }
  .status { font-family:'Orbitron',monospace; font-size:0.6rem; color:rgba(200,140,30,0.6); }
  .dot { display:inline-block; width:6px; height:6px; border-radius:50%; background:#d4a030; box-shadow:0 0 6px #d4a030; animation:blink 2s infinite; vertical-align:middle; margin-right:4px; }
  @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.2} }

  .wave { display:flex; align-items:center; justify-content:center; gap:3px; height:30px; margin:8px 0; }
  .wb { width:3px; border-radius:3px; background:#c8820a; height:4px; opacity:0.25; animation:wv 1.2s ease-in-out infinite; }
  .wb.on { opacity:1; }
  .wb:nth-child(1){animation-delay:0s}.wb:nth-child(2){animation-delay:.1s}.wb:nth-child(3){animation-delay:.2s}
  .wb:nth-child(4){animation-delay:.3s}.wb:nth-child(5){animation-delay:.4s}.wb:nth-child(6){animation-delay:.3s}
  .wb:nth-child(7){animation-delay:.2s}.wb:nth-child(8){animation-delay:.1s}.wb:nth-child(9){animation-delay:0s}
  @keyframes wv { 0%,100%{height:4px} 50%{height:26px} }

  /* PANEL */
  .panel { background:rgba(20,10,2,0.9); border:1px solid rgba(200,120,20,0.25); border-radius:16px; backdrop-filter:blur(20px); box-shadow:0 0 30px rgba(200,100,0,0.1); position:relative; overflow:hidden; flex:1; display:flex; flex-direction:column; }
  .panel::before { content:''; position:absolute; top:0; left:0; right:0; height:1px; background:linear-gradient(90deg,transparent,#c8820a,transparent); }
  .corner { position:absolute; width:18px; height:18px; border-color:#c8820a; border-style:solid; opacity:0.4; }
  .tl{top:7px;left:7px;border-width:2px 0 0 2px}
  .tr{top:7px;right:7px;border-width:2px 2px 0 0}
  .bl{bottom:7px;left:7px;border-width:0 0 2px 2px}
  .br{bottom:7px;right:7px;border-width:0 2px 2px 0}

  /* CHAT */
  .chat { flex:1; overflow-y:auto; padding:16px; min-height:300px; max-height:420px; scroll-behavior:smooth; }
  .chat::-webkit-scrollbar{width:3px}
  .chat::-webkit-scrollbar-thumb{background:rgba(200,120,20,0.3);border-radius:3px}
  .welcome { text-align:center; padding:40px 20px; font-family:'Orbitron',monospace; font-size:0.7rem; letter-spacing:0.1em; color:rgba(200,120,20,0.35); line-height:2.2; }
  .msg { margin-bottom:18px; animation:fadein 0.4s ease-out; }
  @keyframes fadein { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none} }
  .msg-lbl { font-family:'Orbitron',monospace; font-size:0.52rem; letter-spacing:0.2em; opacity:0.55; margin-bottom:5px; color:#c8820a; }
  .msg.user .msg-lbl { text-align:right; }
  .bubble { padding:11px 15px; border-radius:12px; line-height:1.65; font-size:0.88rem; max-width:88%; }
  .msg.user .bubble { background:rgba(140,80,10,0.35); border:1px solid rgba(200,120,20,0.3); margin-left:auto; border-bottom-right-radius:3px; color:#f0d9a0; }
  .msg.bot  .bubble { background:rgba(20,10,2,0.8); border:1px solid rgba(200,120,20,0.18); border-bottom-left-radius:3px; color:#e8cc90; }
  .typing { display:none; gap:5px; padding:11px 15px; width:fit-content; background:rgba(20,10,2,0.8); border:1px solid rgba(200,120,20,0.18); border-radius:12px; border-bottom-left-radius:3px; margin-bottom:10px; }
  .td { width:6px; height:6px; border-radius:50%; background:#c8820a; animation:td 1.2s infinite; }
  .td:nth-child(2){animation-delay:.2s}.td:nth-child(3){animation-delay:.4s}
  @keyframes td { 0%,100%{opacity:.3;transform:translateY(0)} 50%{opacity:1;transform:translateY(-4px)} }

  /* INPUT */
  .input-row { display:flex; gap:8px; padding:14px 16px; border-top:1px solid rgba(200,120,20,0.15); align-items:flex-end; }
  #msg { flex:1; padding:11px 14px; background:rgba(15,8,2,0.85); border:1px solid rgba(200,120,20,0.25); border-radius:10px; color:#f0d9a0; font-family:'Exo 2',sans-serif; font-size:0.93rem; outline:none; resize:none; transition:border-color 0.3s; }
  #msg:focus { border-color:#c8820a; }
  #msg::placeholder { color:rgba(200,120,10,0.3); }
  .btns { display:flex; gap:8px; }
  #mic-btn { padding:11px 13px; background:rgba(200,120,10,0.2); border:1px solid #c8820a; border-radius:10px; color:#c8820a; font-size:1.1rem; cursor:pointer; transition:all 0.3s; line-height:1; }
  #mic-btn.listening { background:rgba(255,50,50,0.25); border-color:#ff4444; color:#ff4444; animation:mic-pulse 1s infinite; }
  @keyframes mic-pulse { 0%,100%{box-shadow:0 0 5px rgba(255,50,50,0.5)} 50%{box-shadow:0 0 15px rgba(255,50,50,0.9)} }
  #send { padding:11px 18px; background:rgba(200,120,10,0.2); border:1px solid #c8820a; border-radius:10px; color:#c8820a; font-family:'Orbitron',monospace; font-size:0.68rem; letter-spacing:0.1em; cursor:pointer; transition:all 0.3s; }
  #send:hover:not(:disabled) { box-shadow:0 0 20px rgba(200,120,10,0.5); }
  #send:disabled { opacity:0.35; cursor:not-allowed; }

  .bottom-btns { display:flex; flex-direction:column; }
  #voice-btn { display:block; width:100%; padding:7px; background:transparent; border:none; border-top:1px solid rgba(200,120,20,0.15); color:rgba(200,120,20,0.4); font-family:'Orbitron',monospace; font-size:0.52rem; letter-spacing:0.15em; cursor:pointer; transition:color 0.3s; }
  #voice-btn.on { color:#c8820a; }
  .clear-btn { display:block; width:100%; padding:7px; background:transparent; border:none; border-top:1px solid rgba(200,120,20,0.1); color:rgba(200,120,20,0.3); font-family:'Orbitron',monospace; font-size:0.52rem; letter-spacing:0.15em; cursor:pointer; transition:color 0.3s; }
  .clear-btn:hover { color:rgba(255,60,60,0.6); }
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="jarvis-globe">
      <div class="globe-glow"></div>
      <div class="sphere"></div>
      <div class="orbit o1"></div><div class="orbit o2"></div><div class="orbit o3"></div><div class="orbit o4"></div>
      <div class="sparks">
        <div class="spark"></div><div class="spark"></div><div class="spark"></div>
        <div class="spark"></div><div class="spark"></div><div class="spark"></div>
      </div>
      <div class="core-bright"></div>
    </div>
    <div class="title">J.A.R.V.I.S</div>
    <div class="subtitle">JUST A RATHER VERY INTELLIGENT SYSTEM</div>
    <div class="status"><span class="dot"></span>ONLINE</div>
    <div class="wave">
      <div class="wb"></div><div class="wb"></div><div class="wb"></div>
      <div class="wb"></div><div class="wb"></div><div class="wb"></div>
      <div class="wb"></div><div class="wb"></div><div class="wb"></div>
    </div>
  </div>

  <div class="panel">
    <div class="corner tl"></div><div class="corner tr"></div>
    <div class="corner bl"></div><div class="corner br"></div>
    <div class="chat" id="chat">
      <div class="welcome" id="welcome">
        â–¸ JARVIS ONLINE<br>â–¸ ALL SYSTEMS NOMINAL<br>â–¸ AWAITING YOUR COMMAND, SIR
      </div>
      <div class="typing" id="typing">
        <div class="td"></div><div class="td"></div><div class="td"></div>
      </div>
    </div>
    <div class="input-row">
      <textarea id="msg" rows="1" placeholder="Speak your command, Sir..."></textarea>
      <div class="btns">
        <button id="mic-btn" title="Voice Input">ðŸŽ¤</button>
        <button id="send">EXECUTE</button>
      </div>
    </div>
    <div class="bottom-btns">
      <button id="voice-btn">â–¸ JARVIS VOICE: OFF</button>
      <button class="clear-btn" id="clear-btn">â–¸ CLEAR MEMORY</button>
    </div>
  </div>
</div>

<script>
// === VOICE INPUT (MIC) ===
var recognition = null;
var isListening = false;

document.getElementById('mic-btn').addEventListener('click', function() {
  var SpeechRec = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SpeechRec) { alert('Voice not supported on this browser'); return; }
  if (isListening) { recognition.stop(); return; }
  recognition = new SpeechRec();
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.lang = 'en-US';
  recognition.onstart = function() {
    isListening = true;
    document.getElementById('mic-btn').classList.add('listening');
    document.getElementById('mic-btn').textContent = 'ðŸ”´';
  };
  recognition.onresult = function(e) {
    document.getElementById('msg').value = e.results[0][0].transcript;
  };
  recognition.onend = function() {
    isListening = false;
    document.getElementById('mic-btn').classList.remove('listening');
    document.getElementById('mic-btn').textContent = 'ðŸŽ¤';
  };
  recognition.onerror = function() {
    isListening = false;
    document.getElementById('mic-btn').classList.remove('listening');
    document.getElementById('mic-btn').textContent = 'ðŸŽ¤';
  };
  recognition.start();
});

// === JARVIS VOICE OUTPUT ===
var voiceEnabled = false;
document.getElementById('voice-btn').addEventListener('click', function() {
  voiceEnabled = !voiceEnabled;
  this.textContent = 'â–¸ JARVIS VOICE: ' + (voiceEnabled ? 'ON' : 'OFF');
  this.classList.toggle('on', voiceEnabled);
});

function speak(text) {
  if (!voiceEnabled || !window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  var u = new SpeechSynthesisUtterance(text);
  u.rate = 0.9;
  u.pitch = 0.85;
  u.volume = 1;
  var voices = window.speechSynthesis.getVoices();
  var brit = null;
  for (var i = 0; i < voices.length; i++) {
    if (voices[i].lang === 'en-GB') { brit = voices[i]; break; }
  }
  if (!brit) {
    for (var j = 0; j < voices.length; j++) {
      if (voices[j].lang.indexOf('en') === 0) { brit = voices[j]; break; }
    }
  }
  if (brit) u.voice = brit;
  window.speechSynthesis.speak(u);
}

// === CHAT ===
function addMsg(role, text) {
  var welc = document.getElementById('welcome');
  if (welc) welc.remove();
  var chat = document.getElementById('chat');
  var typing = document.getElementById('typing');
  var div = document.createElement('div');
  div.className = 'msg ' + role;
  div.innerHTML = '<div class="msg-lbl">' + (role === 'user' ? 'â–¸ YOU' : 'â–¸ J.A.R.V.I.S') + '</div><div class="bubble">' + text.replace(/\n/g, '<br>') + '</div>';
  chat.insertBefore(div, typing);
  chat.scrollTop = chat.scrollHeight;
}

document.getElementById('send').addEventListener('click', sendMsg);
document.getElementById('msg').addEventListener('keydown', function(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendMsg(); }
});
document.getElementById('msg').addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 110) + 'px';
});

function sendMsg() {
  var text = document.getElementById('msg').value.trim();
  if (!text) return;
  document.getElementById('msg').value = '';
  document.getElementById('msg').style.height = 'auto';
  addMsg('user', text);
  document.getElementById('typing').style.display = 'flex';
  document.getElementById('send').disabled = true;
  document.querySelectorAll('.wb').forEach(function(b) { b.classList.add('on'); });

  fetch('/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: text })
  })
  .then(function(r) { return r.json(); })
  .then(function(d) {
    document.getElementById('typing').style.display = 'none';
    var reply = d.reply || ('âš  ' + (d.error || 'Error'));
    addMsg('bot', reply);
    speak(reply);
  })
  .catch(function() {
    document.getElementById('typing').style.display = 'none';
    addMsg('bot', 'âš  Connection error, Sir. Please wait and try again.');
  })
  .finally(function() {
    document.getElementById('send').disabled = false;
    document.querySelectorAll('.wb').forEach(function(b) { b.classList.remove('on'); });
    document.getElementById('chat').scrollTop = 9999;
  });
}

document.getElementById('clear-btn').addEventListener('click', function() {
  fetch('/clear', { method: 'POST' }).then(function() {
    document.getElementById('chat').innerHTML = '<div class="welcome" id="welcome">â–¸ MEMORY CLEARED<br>â–¸ READY FOR NEW ORDERS, SIR</div><div class="typing" id="typing" style="display:none"><div class="td"></div><div class="td"></div><div class="td"></div></div>';
  });
});
</script>
</body>
</html>
