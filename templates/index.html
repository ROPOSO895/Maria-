<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0d0015">
<title>MARIA</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: #0d0015; color: #eee; font-family: 'Poppins', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
.top { background: #1a0030; padding: 12px 16px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid rgba(255,110,180,0.3); flex-shrink: 0; }
.avatar { width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #ff6eb4, #b44fff); display: flex; align-items: center; justify-content: center; font-size: 1.2rem; flex-shrink: 0; }
.name { font-weight: 600; font-size: 1rem; color: #ff6eb4; }
.status { font-size: 0.7rem; color: rgba(255,255,255,0.4); }
.clk { margin-left: auto; font-size: 0.75rem; color: rgba(255,255,255,0.4); }
.msgs { flex: 1; overflow-y: auto; padding: 16px; display: flex; flex-direction: column; gap: 12px; }
.msgs::-webkit-scrollbar { width: 3px; }
.msgs::-webkit-scrollbar-thumb { background: rgba(255,110,180,0.3); border-radius: 3px; }
.msg { display: flex; flex-direction: column; max-width: 80%; }
.msg.u { align-self: flex-end; align-items: flex-end; }
.msg.b { align-self: flex-start; align-items: flex-start; }
.lbl { font-size: 0.6rem; color: rgba(255,255,255,0.3); margin-bottom: 4px; }
.bub { padding: 10px 14px; border-radius: 18px; font-size: 0.9rem; line-height: 1.6; font-weight: 300; }
.msg.u .bub { background: linear-gradient(135deg, rgba(255,110,180,0.25), rgba(180,79,255,0.2)); border: 1px solid rgba(255,110,180,0.3); border-bottom-right-radius: 4px; }
.msg.b .bub { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1); border-bottom-left-radius: 4px; color: rgba(255,255,255,0.85); }
.typing { display: none; align-self: flex-start; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1); border-radius: 18px; border-bottom-left-radius: 4px; padding: 12px 16px; gap: 5px; }
.typing.show { display: flex; }
.dot { width: 7px; height: 7px; border-radius: 50%; background: #b44fff; animation: bounce 1.2s infinite; }
.dot:nth-child(2) { animation-delay: 0.2s; }
.dot:nth-child(3) { animation-delay: 0.4s; }
@keyframes bounce { 0%, 100% { transform: translateY(0); opacity: 0.4; } 50% { transform: translateY(-5px); opacity: 1; } }
.bot { background: #1a0030; border-top: 1px solid rgba(255,110,180,0.2); padding: 10px 12px; display: flex; gap: 8px; align-items: flex-end; flex-shrink: 0; }
#msg { flex: 1; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,110,180,0.3); border-radius: 22px; padding: 10px 16px; color: white; font-family: 'Poppins', sans-serif; font-size: 0.9rem; outline: none; resize: none; max-height: 100px; }
#msg:focus { border-color: #ff6eb4; }
#msg::placeholder { color: rgba(255,255,255,0.25); }
#sbtn { width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, #ff6eb4, #b44fff); border: none; color: white; font-size: 1.1rem; cursor: pointer; flex-shrink: 0; box-shadow: 0 0 15px rgba(255,110,180,0.4); }
#sbtn:disabled { opacity: 0.4; cursor: not-allowed; }
.search-item { background: rgba(255,255,255,0.04); border: 1px solid rgba(255,110,180,0.1); border-radius: 10px; padding: 8px 10px; margin-bottom: 6px; }
.search-title { font-size: 0.75rem; color: #ff6eb4; font-weight: 500; margin-bottom: 3px; }
.search-snip { font-size: 0.72rem; color: rgba(255,255,255,0.6); line-height: 1.5; }
.search-link { font-size: 0.62rem; color: #b44fff; margin-top: 3px; display: block; }
.search-img { width: 100%; max-height: 150px; object-fit: cover; border-radius: 8px; margin-bottom: 6px; }
</style>
</head>
<body>

<div class="top">
  <div class="avatar">üå∏</div>
  <div>
    <div class="name">Maria</div>
    <div class="status" id="statusTxt">‚óè Online</div>
  </div>
  <div class="clk" id="clk">--:--</div>
</div>

<div class="msgs" id="msgs"></div>
<div class="typing" id="typing">
  <div class="dot"></div><div class="dot"></div><div class="dot"></div>
</div>

<div class="bot">
  <textarea id="msg" rows="1" placeholder="Talk to Maria..."></textarea>
  <button id="sbtn" onclick="send()">&#9658;</button>
</div>

<script>
var BASE = 'https://maria-assistant-fthu.onrender.com';

setInterval(function() {
  var n = new Date(), h = n.getHours(), m = n.getMinutes();
  document.getElementById('clk').textContent = (h<10?'0'+h:h)+':'+(m<10?'0'+m:m);
}, 1000);

document.getElementById('msg').addEventListener('input', function() {
  this.style.height = 'auto';
  this.style.height = Math.min(this.scrollHeight, 100) + 'px';
});
document.getElementById('msg').addEventListener('keydown', function(e) {
  if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }
});

function addMsg(role, text) {
  var msgs = document.getElementById('msgs');
  var d = document.createElement('div');
  d.className = 'msg ' + role;
  var safe = text.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br>');
  d.innerHTML = '<div class="lbl">'+(role==='u'?'You':'Maria')+'</div><div class="bub">'+safe+'</div>';
  msgs.appendChild(d);
  msgs.scrollTop = msgs.scrollHeight;
  return d;
}

function isSearch(txt) {
  var l = txt.toLowerCase();
  return l.match(/^(search|find|show|image|photo|picture|who is|what is|kaun hai|dikhaao|tasveer)/);
}

function doSearch(txt) {
  var d = addMsg('b', 'Searching...');
  fetch(BASE + '/search?q=' + encodeURIComponent(txt))
  .then(function(r){return r.json();})
  .then(function(data){
    var h = '';
    if (data.results && data.results.length) {
      data.results.forEach(function(r) {
        if (r.image) h += '<img class="search-img" src="'+r.image+'" onerror="this.style.display=\'none\'">';
        h += '<div class="search-item"><div class="search-title">'+r.title+'</div><div class="search-snip">'+r.snippet+'</div>';
        if (r.url) h += '<a class="search-link" href="'+r.url+'" target="_blank">Read more &#8594;</a>';
        h += '</div>';
      });
    } else {
      h = 'Kuch nahi mila yaar. Google try karo!';
    }
    d.querySelector('.bub').innerHTML = h;
    document.getElementById('msgs').scrollTop = 99999;
  }).catch(function(){
    d.querySelector('.bub').innerHTML = 'Search nahi ho paya, dobara try karo';
  });
}

function send() {
  var inp = document.getElementById('msg');
  var txt = inp.value.trim();
  if (!txt) return;
  inp.value = ''; inp.style.height = 'auto';
  addMsg('u', txt);

  if (isSearch(txt)) { doSearch(txt); return; }

  var btn = document.getElementById('sbtn');
  btn.disabled = true;
  document.getElementById('statusTxt').textContent = '‚óè Thinking...';
  document.getElementById('typing').classList.add('show');
  document.getElementById('msgs').scrollTop = 99999;

  fetch(BASE + '/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: txt })
  })
  .then(function(r) { return r.json(); })
  .then(function(d) {
    document.getElementById('typing').classList.remove('show');
    btn.disabled = false;
    document.getElementById('statusTxt').textContent = '‚óè Online';
    addMsg('b', d.reply || 'Kuch toh hua yaar, dobara try karo');
  })
  .catch(function() {
    document.getElementById('typing').classList.remove('show');
    btn.disabled = false;
    document.getElementById('statusTxt').textContent = '‚óè Online';
    addMsg('b', 'Connection weak hai, dobara try karo');
  });
}

// Auto greet
setTimeout(function() {
  var h = new Date().getHours();
  var t = h < 12 ? 'subah' : h < 17 ? 'dopahar' : 'shaam';
  fetch(BASE + '/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: 'Give a short warm ' + t + ' greeting in Hinglish. No emojis. Max 2 sentences. Sound like a real close friend.' })
  })
  .then(function(r){return r.json();})
  .then(function(d){ if(d.reply) addMsg('b', d.reply); })
  .catch(function(){});
}, 1000);
</script>
</body>
</html>
