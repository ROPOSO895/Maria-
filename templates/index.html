<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>J.A.R.V.I.S</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: #050300;
    color: #f0d9a0;
    font-family: 'Exo 2', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(180,100,20,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(180,100,20,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
    z-index: 0;
  }

  .app {
    position: relative;
    z-index: 1;
    max-width: 700px;
    margin: 0 auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  .header { text-align: center; padding: 20px 0 12px; }

  /* ===== JARVIS GLOBE ===== */
  .jarvis-globe {
    position: relative;
    width: 200px;
    height: 200px;
    margin: 0 auto 16px;
  }

  /* Outer glow */
  .globe-glow {
    position: absolute;
    inset: -20px;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(255,120,0,0.15) 0%, transparent 70%);
    animation: glow-pulse 2.5s ease-in-out infinite;
  }

  @keyframes glow-pulse {
    0%,100% { transform: scale(1); opacity: 0.6; }
    50% { transform: scale(1.15); opacity: 1; }
  }

  /* Main sphere */
  .sphere {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background:
      radial-gradient(circle at 40% 35%,
        rgba(255,200,50,0.9) 0%,
        rgba(255,120,0,0.7) 25%,
        rgba(180,60,0,0.5) 50%,
        rgba(80,20,0,0.3) 70%,
        transparent 90%);
    box-shadow:
      0 0 40px rgba(255,120,0,0.6),
      0 0 80px rgba(255,80,0,0.3),
      0 0 120px rgba(200,50,0,0.15),
      inset 0 0 30px rgba(255,150,0,0.2);
    animation: sphere-pulse 3s ease-in-out infinite;
  }

  @keyframes sphere-pulse {
    0%,100% { box-shadow: 0 0 40px rgba(255,120,0,0.6), 0 0 80px rgba(255,80,0,0.3), inset 0 0 30px rgba(255,150,0,0.2); }
    50% { box-shadow: 0 0 60px rgba(255,150,0,0.9), 0 0 120px rgba(255,80,0,0.5), inset 0 0 50px rgba(255,180,0,0.4); }
  }

  /* Orbit rings */
  .orbit {
    position: absolute;
    border-radius: 50%;
    border: 1px solid rgba(255,140,0,0.4);
    animation: spin linear infinite;
  }

  .orbit-1 {
    inset: 10px;
    border-color: rgba(255,160,30,0.5);
    border-top-color: rgba(255,200,50,0.9);
    animation-duration: 4s;
    box-shadow: 0 0 8px rgba(255,160,30,0.3);
  }
  .orbit-2 {
    inset: 25px;
    border-color: rgba(255,120,0,0.3);
    border-right-color: rgba(255,180,0,0.8);
    animation-duration: 3s;
    animation-direction: reverse;
  }
  .orbit-3 {
    inset: 40px;
    border-color: rgba(200,80,0,0.25);
    border-bottom-color: rgba(255,140,0,0.7);
    animation-duration: 5s;
  }
  .orbit-4 {
    inset: 55px;
    border-color: rgba(180,60,0,0.2);
    border-left-color: rgba(255,120,0,0.6);
    animation-duration: 2.5s;
    animation-direction: reverse;
  }

  @keyframes spin { to { transform: rotate(360deg); } }

  /* Particles / sparks */
  .sparks {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    overflow: hidden;
  }

  .spark {
    position: absolute;
    width: 2px;
    height: 2px;
    border-radius: 50%;
    background: #ffdd00;
    box-shadow: 0 0 4px #ff8800;
    animation: float-spark linear infinite;
  }

  .spark:nth-child(1)  { top:20%; left:60%; animation-duration:3s; animation-delay:0s; }
  .spark:nth-child(2)  { top:70%; left:30%; animation-duration:4s; animation-delay:0.5s; }
  .spark:nth-child(3)  { top:40%; left:80%; animation-duration:2.5s; animation-delay:1s; }
  .spark:nth-child(4)  { top:80%; left:60%; animation-duration:3.5s; animation-delay:0.3s; }
  .spark:nth-child(5)  { top:30%; left:20%; animation-duration:4.5s; animation-delay:0.8s; }
  .spark:nth-child(6)  { top:60%; left:75%; animation-duration:2s; animation-delay:1.5s; }
  .spark:nth-child(7)  { top:15%; left:45%; animation-duration:3.2s; animation-delay:0.2s; }
  .spark:nth-child(8)  { top:85%; left:40%; animation-duration:2.8s; animation-delay:0.9s; }
  .spark:nth-child(9)  { top:50%; left:15%; animation-duration:3.8s; animation-delay:1.2s; }
  .spark:nth-child(10) { top:25%; left:70%; animation-duration:2.2s; animation-delay:0.6s; }

  @keyframes float-spark {
    0%   { transform: translateY(0) scale(1); opacity: 1; }
    50%  { transform: translateY(-15px) scale(1.5); opacity: 0.8; }
    100% { transform: translateY(-30px) scale(0); opacity: 0; }
  }

  /* Grid lines on sphere */
  .grid-lines {
    position: absolute;
    inset: 5px;
    border-radius: 50%;
    border: 1px solid rgba(255,140,0,0.1);
    background:
      repeating-linear-gradient(
        0deg,
        transparent,
        transparent 18px,
        rgba(255,120,0,0.08) 18px,
        rgba(255,120,0,0.08) 19px
      ),
      repeating-linear-gradient(
        90deg,
        transparent,
        transparent 18px,
        rgba(255,120,0,0.08) 18px,
        rgba(255,120,0,0.08) 19px
      );
    animation: spin 20s linear infinite;
    border-radius: 50%;
    overflow: hidden;
  }

  /* Center bright core */
  .core-bright {
    position: absolute;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 30px; height: 30px;
    border-radius: 50%;
    background: radial-gradient(circle, #ffffff 0%, #ffee00 30%, #ff8800 60%, transparent 80%);
    box-shadow: 0 0 20px #ffcc00, 0 0 40px #ff8800;
    animation: core-flicker 1.5s ease-in-out infinite;
  }

  @keyframes core-flicker {
    0%,100% { transform: translate(-50%,-50%) scale(1); opacity: 1; }
    30% { transform: translate(-50%,-50%) scale(1.2); opacity: 0.9; }
    60% { transform: translate(-50%,-50%) scale(0.9); opacity: 1; }
    80% { transform: translate(-50%,-50%) scale(1.1); opacity: 0.95; }
  }

  /* Title */
  .title {
    font-family: 'Orbitron', monospace;
    font-size: clamp(1.8rem, 6vw, 3rem);
    font-weight: 900;
    color: #d4860a;
    letter-spacing: 0.3em;
    animation: title-glow 3s ease-in-out infinite;
  }
  @keyframes title-glow {
    0%,100% { text-shadow: 0 0 20px rgba(220,140,0,0.6), 0 0 40px rgba(180,80,0,0.3); }
    50% { text-shadow: 0 0 35px rgba(255,180,0,1), 0 0 70px rgba(220,100,0,0.5); }
  }

  .subtitle {
    font-family: 'Orbitron', monospace;
    font-size: 0.52rem;
    letter-spacing: 0.35em;
    color: rgba(210,130,20,0.4);
    margin: 4px 0 8px;
  }

  .status {
    display: flex; justify-content: center; gap: 16px;
    font-family: 'Orbitron', monospace; font-size: 0.6rem;
    color: rgba(210,140,30,0.55);
  }
  .dot {
    display: inline-block; width:6px; height:6px; border-radius:50%;
    background:#d4a030; box-shadow: 0 0 6px #d4a030;
    animation: blink-dot 2s infinite; vertical-align: middle; margin-right:4px;
  }
  @keyframes blink-dot { 0%,100%{opacity:1} 50%{opacity:0.2} }

  .wave { display:flex; align-items:center; justify-content:center; gap:3px; height:28px; margin:8px 0; }
  .wb { width:3px; border-radius:3px; background:#c8820a; height:4px; opacity:0.25; animation: wv 1.2s ease-in-out infinite; }
  .wb.on { opacity:1; }
  .wb:nth-child(1){animation-delay:0s} .wb:nth-child(2){animation-delay:.1s} .wb:nth-child(3){animation-delay:.2s}
  .wb:nth-child(4){animation-delay:.3s} .wb:nth-child(5){animation-delay:.4s} .wb:nth-child(6){animation-delay:.3s}
  .wb:nth-child(7){animation-delay:.2s} .wb:nth-child(8){animation-delay:.1s} .wb:nth-child(9){animation-delay:0s}
  @keyframes wv { 0%,100%{height:4px} 50%{height:24px} }

  /* Panel */
  .panel {
    background: rgba(20,10,2,0.9);
    border: 1px solid rgba(200,120,20,0.25);
    border-radius: 16px;
    backdrop-filter: blur(20px);
    box-shadow: 0 0 30px rgba(200,100,0,0.1);
    position: relative; overflow: hidden;
    flex: 1; display: flex; flex-direction: column;
  }
  .panel::before {
    content:''; position:absolute; top:0; left:0; right:0; height:1px;
    background: linear-gradient(90deg, transparent, #c8820a, transparent);
  }

  .corner { position:absolute; width:18px; height:18px; border-color:#c8820a; border-style:solid; opacity:0.4; }
  .tl{top:7px;left:7px;border-width:2px 0 0 2px}
  .tr{top:7px;right:7px;border-width:2px 2px 0 0}
  .bl{bottom:7px;left:7px;border-width:0 0 2px 2px}
  .br{bottom:7px;right:7px;border-width:0 2px 2px 0}

  .chat {
    flex:1; overflow-y:auto; padding:16px;
    min-height:280px; max-height:400px; scroll-behavior:smooth;
  }
  .chat::-webkit-scrollbar{width:3px}
  .chat::-webkit-scrollbar-thumb{background:rgba(200,120,20,0.3);border-radius:3px}

  .welcome {
    text-align:center; padding:35px 20px;
    font-family:'Orbitron',monospace; font-size:0.68rem;
    letter-spacing:0.1em; color:rgba(200,120,20,0.35); line-height:2.2;
  }

  .msg { margin-bottom:16px; animation: fadein 0.4s ease-out; }
  @keyframes fadein { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none} }

  .msg-lbl {
    font-family:'Orbitron',monospace; font-size:0.5rem;
    letter-spacing:0.2em; opacity:0.55; margin-bottom:5px;
  }
  .msg.user .msg-lbl { color:#d4a030; text-align:right; }
  .msg.bot  .msg-lbl { color:#c8820a; }

  .bubble { padding:11px 15px; border-radius:12px; line-height:1.65; font-size:0.88rem; max-width:88%; }
  .msg.user .bubble {
    background:rgba(120,60,5,0.35); border:1px solid rgba(200,120,20,0.3);
    margin-left:auto; border-bottom-right-radius:3px; color:#f0d090;
  }
  .msg.bot .bubble {
    background:rgba(15,7,1,0.85); border:1px solid rgba(180,100,10,0.2);
    border-bottom-left-radius:3px; color:#e8c880;
  }

  .typing { display:none; gap:5px; padding:11px 15px; width:fit-content;
    background:rgba(15,7,1,0.85); border:1px solid rgba(180,100,10,0.2);
    border-radius:12px; border-bottom-left-radius:3px; margin-bottom:10px; }
  .td { width:6px;height:6px;border-radius:50%;background:#c8820a; animation:td 1.2s infinite; }
  .td:nth-child(2){animation-delay:.2s} .td:nth-child(3){animation-delay:.4s}
  @keyframes td{ 0%,100%{opacity:.3;transform:translateY(0)} 50%{opacity:1;transform:translateY(-4px)} }

  .input-row { display:flex; gap:8px; padding:12px 14px; border-top:1px solid rgba(180,100,10,0.15); }

  #msg {
    flex:1; padding:11px 14px;
    background:rgba(12,5,1,0.9);
    border:1px solid rgba(180,100,10,0.25);
    border-radius:10px; color:#f0d090;
    font-family:'Exo 2',sans-serif; font-size:0.93rem;
    outline:none; resize:none; transition:all 0.3s;
  }
  #msg:focus { border-color:#c8820a; box-shadow:0 0 12px rgba(200,120,10,0.2); }
  #msg::placeholder { color:rgba(180,100,10,0.3); }

  #send {
    padding:11px 18px;
    background:linear-gradient(135deg,rgba(200,120,10,0.2),rgba(140,60,5,0.3));
    border:1px solid #c8820a; border-radius:10px;
    color:#d4920a; font-family:'Orbitron',monospace;
    font-size:0.68rem; letter-spacing:0.1em;
    cursor:pointer; transition:all 0.3s;
    box-shadow:0 0 10px rgba(200,120,10,0.15);
  }
  #send:hover:not(:disabled) { box-shadow:0 0 22px rgba(220,150,10,0.5); transform:translateY(-1px); }
  #send:disabled { opacity:0.35; cursor:not-allowed; }

  .clear-btn {
    display:block; width:100%; padding:7px; background:transparent;
    border:none; border-top:1px solid rgba(180,100,10,0.1);
    color:rgba(180,100,10,0.35); font-family:'Orbitron',monospace;
    font-size:0.52rem; letter-spacing:0.15em; cursor:pointer; transition:color 0.3s;
  }
  .clear-btn:hover { color:rgba(255,60,60,0.6); }
</style>
</head>
<body>
<div class="app">
  <div class="header">

    <!-- JARVIS GLOBE -->
    <div class="jarvis-globe">
      <div class="globe-glow"></div>
      <div class="sphere"></div>
      <div class="grid-lines"></div>
      <div class="orbit orbit-1"></div>
      <div class="orbit orbit-2"></div>
      <div class="orbit orbit-3"></div>
      <div class="orbit orbit-4"></div>
      <div class="sparks">
        <div class="spark"></div><div class="spark"></div><div class="spark"></div>
        <div class="spark"></div><div class="spark"></div><div class="spark"></div>
        <div class="spark"></div><div class="spark"></div><div class="spark"></div>
        <div class="spark"></div>
      </div>
      <div class="core-bright"></div>
    </div>

    <div class="title">J.A.R.V.I.S</div>
    <div class="subtitle">JUST A RATHER VERY INTELLIGENT SYSTEM</div>
    <div class="status">
      <span><span class="dot"></span>ONLINE</span>
      <span id="clock"></span>
    </div>
    <div class="wave">
      <div class="wb"></div><div class="wb"></div><div class="wb"></div>
      <div class="wb"></div><div class="wb"></div><div class="wb"></div>
      <div class="wb"></div><div class="wb"></div><div class="wb"></div>
    </div>
  </div>

  <div class="panel">
    <div class="corner tl"></div><div class="corner tr"></div>
    <div class="corner bl"></div><div class="corner br"></div>

    <div class="chat" id="chat">
      <div class="welcome" id="welcome">
        ▸ JARVIS ONLINE<br>
        ▸ ALL SYSTEMS NOMINAL<br>
        ▸ AWAITING YOUR COMMAND, SIR
      </div>
      <div class="typing" id="typing">
        <div class="td"></div><div class="td"></div><div class="td"></div>
      </div>
    </div>

    <div class="input-row">
      <textarea id="msg" rows="1" placeholder="Speak your command, Sir..."></textarea>
      <button id="send" onclick="send()">EXECUTE</button>
    </div>
    <button class="clear-btn" onclick="clearChat()">▸ CLEAR MEMORY</button>
  </div>
</div>

<script>
  setInterval(() => {
    document.getElementById('clock').textContent =
      new Date().toLocaleTimeString('en-US',{hour12:false});
  }, 1000);

  const msgEl = document.getElementById('msg');
  msgEl.addEventListener('input', () => {
    msgEl.style.height = 'auto';
    msgEl.style.height = Math.min(msgEl.scrollHeight, 110) + 'px';
  });
  msgEl.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); send(); }
  });

  function addMsg(role, text) {
    document.getElementById('welcome')?.remove();
    const chat = document.getElementById('chat');
    const typing = document.getElementById('typing');
    const div = document.createElement('div');
    div.className = `msg ${role}`;
    div.innerHTML = `
      <div class="msg-lbl">${role === 'user' ? '▸ YOU' : '▸ J.A.R.V.I.S'}</div>
      <div class="bubble">${text.replace(/\n/g,'<br>')}</div>`;
    chat.insertBefore(div, typing);
    chat.scrollTop = chat.scrollHeight;
  }

  async function send() {
    const text = msgEl.value.trim();
    if (!text) return;
    msgEl.value = ''; msgEl.style.height = 'auto';
    addMsg('user', text);

    document.getElementById('typing').style.display = 'flex';
    document.getElementById('send').disabled = true;
    document.querySelectorAll('.wb').forEach(b => b.classList.add('on'));

    try {
      const res = await fetch('/chat', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify({message: text})
      });
      const data = await res.json();
      document.getElementById('typing').style.display = 'none';
      addMsg('bot', data.reply || '⚠ ' + (data.error || 'Unknown error'));
    } catch(e) {
      document.getElementById('typing').style.display = 'none';
      addMsg('bot', '⚠ Connection error, Sir.');
    }

    document.getElementById('send').disabled = false;
    document.querySelectorAll('.wb').forEach(b => b.classList.remove('on'));
    document.getElementById('chat').scrollTop = 9999;
  }

  async function clearChat() {
    await fetch('/clear', {method:'POST'});
    document.getElementById('chat').innerHTML = `
      <div class="welcome" id="welcome">
        ▸ MEMORY CLEARED<br>▸ READY FOR NEW ORDERS, SIR
      </div>
      <div class="typing" id="typing" style="display:none">
        <div class="td"></div><div class="td"></div><div class="td"></div>
      </div>`;
  }
</script>
</body>
</html>
